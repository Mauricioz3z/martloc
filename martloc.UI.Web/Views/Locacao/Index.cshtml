
@{


    ViewData["Title"] = "Index";
}

@*<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" rel="stylesheet" />*@


@*<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.css" />*@






@*<div class="container">

    <div class="row mb-5">

        <div class="col-12">

            <div class="card">
                <div class="card-body">

                    <form>
                        <div class="form-group">
                            <label for="exampleInputEmail1">Nome</label>
                            <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="nome">
                           
                        </div>


                        <button type="submit" class="btn btn-primary"><i class="fas fa-filter"></i> Filtrar</button>
                        <button type="submit" class="btn btn-secondary"><i class="fas fa-window-close"></i> Limpar</button>
                    </form>
                </div>
            </div>
        </div>



    </div>


    <div class="row">

        <div class="col-12">


            <div class="card">
                <div class="card-body">

                    <table id="example" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Id</th>
                                <th>Status</th>
                                <th>Data Contrato</th>

                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                        <tfoot>
                            <tr>
                                <th></th>
                                <th>Id</th>
                                <th>Status</th>
                                <th>Data Contrato</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

        </div>



    </div>

</div>*@




<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1>Locações</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                    <li class="breadcrumb-item active">Locações</li>
                </ol>
            </div>
        </div>
    </div><!-- /.container-fluid -->
    </section>
    <section class="content">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Lista de todas as locações</h3>
                    </div>
                    <!-- /.card-header -->
                    <div class="card-body">
                        <table id="example" class="table table-striped table-bordered" style="width:100%">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>Id</th>
                                    <th>Descrição</th>
                                    <th>Status</th>
                                    <th>Data Contrato</th>

                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <th></th>
                                    <th>Id</th>
                                    <th>Descrição</th>
                                    
                                    <th>Status</th>
                                    <th>Data Contrato</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
               
                </div>
                </div>
            </div>

    </section>


    @section Scripts {





        <script>



            $(document).ready(function () {
                //$('#example').DataTable();

                function format(d) {
                    // `d` is the original data object for the row
                    var content = '';

                    d.locacaoItens.forEach(function (a) {


                        if (a.equipamento != undefined) {
                            content +=
                                '<tr>' +
                                '<td>' + a.equipamento.id + '</td>' +
                                '<td>' + a.equipamento.descricao + '</td>' +
                                '</tr>'
                        }






                    })

                    return '<table class="table table-striped table-bordered">'+
                        '<thead style="background-color: #17a2b8;color: #fff;"  >'+
                        '<tr><th colspan="2">Itens Da Locação</th>'+
                        '</tr>'+
                        '</thead > '+
                      
                        '<th>Id</th>' +
                        '<th>Descricao</th>'+ content + '</table>';

                }


                var table = $('#example').DataTable({
                  
          "language": {
              "url": "https://cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Portuguese-Brasil.json"
          } , 
                    "ajax": "https://localhost:44344/locacao/GetLocacoes",
                    "columns": [
                        {
                            "className": 'details-control',
                            "orderable": false,
                            "data": null,
                            "defaultContent": '<i class="fas fa-search text-primary"></i>'
                        },
                        { "data": "id", },
                        { "data": "descricao" },
                        { "data": "status","render": function (data, type, row, meta) {
                                console.log('data:',data)
                            if (data == 1) { return '<span class="right badge badge-success">Ativo</span>'; }
                            else {return '<span class="right badge badge-danger">Inativo</span>';}
                                    

                                
                            } },
                       

                        { "data": "dataContrato" },

                    ],
                    "order": [[1, 'asc']],
       

                });

                $('#example tbody').on('click', 'td.details-control', function () {

                    var tr = $(this).closest('tr');
                    var row = table.row(tr);

                    if (row.child.isShown()) {
                        // This row is already open - close it
                        row.child.hide();
                        tr.removeClass('shown');
                    }
                    else {

                        //console.log('row-data',row.data().locacaoItens)

                        // Open this row
                        row.child(format(row.data())).show();
                        tr.addClass('shown');
                    }
                });



            });

        </script>
    }
